<!doctype html>
<html lang="sr">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Buon Natale üéÑ</title>

  <style>
    :root {
      --snow: rgba(255, 255, 255, 0.92);
    }

    html,
    body {
      height: 100%;
      min-height: 100vh;
      min-height: 100dvh;
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      overflow: hidden;
      color: #fff;
      background: #000;
    }

    .bg {
      position: fixed;
      inset: 0;
      background: url("bg.jpg") center/cover no-repeat;
      filter: saturate(1.05) contrast(1.05);
    }

    .overlay {
      position: fixed;
      inset: 0;
      background:
        radial-gradient(circle at 50% 45%, rgba(255, 255, 255, 0.10), rgba(0, 0, 0, 0.55) 60%, rgba(0, 0, 0, 0.82) 100%),
        linear-gradient(to bottom, rgba(0, 0, 0, 0.1), rgba(0, 0, 0, 0.5));
      pointer-events: none;
    }

    .center {
      position: absolute;
      inset: 0;
      display: grid;
      place-items: center;
      text-align: center;
      padding: 24px;
      z-index: 20;
      backdrop-filter: blur(3px);
    }

    .card {
      max-width: 520px;
      width: min(92vw, 520px);
      padding: 22px 18px;
      border-radius: 18px;
      background: rgba(0, 0, 0, 0.35);
      border: 1px solid rgba(255, 255, 255, 0.15);
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.45);
    }

    .title {
      font-size: clamp(28px, 5vw, 44px);
      margin: 0 0 10px;
    }

    .subtitle {
      opacity: 0.9;
      margin: 0 0 18px;
      line-height: 1.35;
    }

    .btn {
      font-size: 1.05rem;
      padding: 12px 20px;
      border-radius: 999px;
      background: #fff;
      color: #111;
      border: none;
      cursor: pointer;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.35);
    }

    .btn:active {
      transform: scale(0.98);
    }

    .snowflake {
      position: fixed;
      top: -10px;
      width: 6px;
      height: 6px;
      background: var(--snow);
      border-radius: 50%;
      filter: drop-shadow(0 0 6px rgba(255, 255, 255, 0.9));
      animation: fall linear infinite;
      opacity: 0.95;
      z-index: 10;
      pointer-events: none;
    }

    @keyframes fall {
      to {
        transform: translateY(110vh) translateX(var(--drift));
      }
    }

    .stage {
      position: fixed;
      left: -40vw;
      top: 14vh;
      width: min(520px, 60vw);
      aspect-ratio: 16 / 9;
      pointer-events: none;
      z-index: 15;
      display: none;
      animation: fly 9s ease-in-out infinite;
      filter: drop-shadow(0 18px 18px rgba(0, 0, 0, 0.35));
    }

    @keyframes fly {
      0% {
        transform: translateX(-60vw) translateY(2vh) scale(0.75);
        opacity: 0;
      }

      10% {
        opacity: 1;
      }

      55% {
        transform: translateX(70vw) translateY(-2vh) scale(1);
      }

      100% {
        transform: translateX(150vw) translateY(1vh) scale(0.9);
        opacity: 0;
      }
    }

    .sleighWrap {
      position: relative;
      width: 100%;
      height: 100%;
    }

    .sleighImg {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      object-fit: contain;
      transform: rotate(-2deg);
    }

    .face {
      position: absolute;
      left: 15%;
      top: 18%;
      width: 18%;
      aspect-ratio: 1 / 1;
      border-radius: 50%;
      object-fit: cover;
      border: 3px solid rgba(255, 255, 255, 0.9);
      box-shadow: 0 10px 24px rgba(0, 0, 0, 0.55);
      filter: saturate(1.05) contrast(1.05);
      transform: rotate(-6deg);
    }

    .faceGlow {
      position: absolute;
      left: 52%;
      top: 16%;
      width: 22%;
      aspect-ratio: 1 / 1;
      border-radius: 50%;
      background: radial-gradient(circle, rgba(255, 255, 255, 0.28), rgba(255, 255, 255, 0) 70%);
      filter: blur(2px);
      opacity: 0.8;
      transform: rotate(-6deg);
      pointer-events: none;
    }

    .credit {
      position: fixed;
      bottom: 10px;
      width: 100%;
      text-align: center;
      font-size: 12px;
      opacity: 0.7;
      z-index: 30;
      text-shadow: 0 2px 10px rgba(0, 0, 0, 0.8);
    }

    /* Gifts */
    .gift {
      position: fixed;
      top: -12vh;
      width: 46px;
      height: 46px;
      cursor: pointer;
      z-index: 16;
      user-select: none;
      -webkit-tap-highlight-color: transparent;
      filter: drop-shadow(0 10px 12px rgba(0, 0, 0, 0.35));
      animation: giftFall linear forwards;
    }

    .gift img {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }

    @keyframes giftFall {
      to {
        transform: translateY(120vh) translateX(var(--drift)) rotate(var(--rot));
      }
    }

    /* Modal */
    .modal {
      position: fixed;
      inset: 0;
      display: none;
      z-index: 50;
    }

    .modal.is-open {
      display: block;
    }

    .modalBackdrop {
      position: absolute;
      inset: 0;
      background: rgba(0, 0, 0, 0.65);
      backdrop-filter: blur(4px);
    }

    .modalCard {
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);

      max-width: 92vw;
      max-height: 86vh;

      border-radius: 18px;
      overflow: hidden;
      border: 1px solid rgba(255, 255, 255, 0.18);
      background: rgba(10, 10, 12, 0.88);
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.6);

      display: inline-flex;
      /* üî• BITNO */
      flex-direction: column;
    }

    .modalBody {
      display: flex;
      align-items: center;
      justify-content: center;

      max-width: 92vw;
      max-height: 70vh;

      background: transparent;
    }


    .modalImg {
      max-width: 92vw;
      max-height: 70vh;
      width: auto;
      height: auto;

      display: block;
    }

    .modalDesc {
      padding: 14px 18px;
      text-align: center;
      background: rgba(0, 0, 0, 0.35);
    }

    .modalClose {
      position: absolute;
      top: 10px;
      right: 10px;
      border: 0;
      border-radius: 999px;
      padding: 10px 12px;
      cursor: pointer;
      background: rgba(255, 255, 255, 0.9);
      color: #111;
      font-weight: 700;
      z-index: 2;
    }


    /* Stars (clickable) */
    .star {
      position: fixed;
      top: -12vh;
      width: 60px;
      height: 60px;
      cursor: pointer;
      z-index: 16;
      user-select: none;
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
      filter: drop-shadow(0 10px 12px rgba(0, 0, 0, 0.35));
      animation: starFall linear forwards;
    }

    .star img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      animation: twinkle 1.8s ease-in-out infinite;
    }

    @keyframes starFall {
      to {
        transform: translateY(120vh) translateX(var(--drift)) rotate(var(--rot));
      }
    }

    @keyframes twinkle {

      0%,
      100% {
        transform: scale(1);
        opacity: 0.9;
      }

      50% {
        transform: scale(1.06);
        opacity: 1;
      }
    }

    /* Video in modal */
    .modalVideo {
      max-width: 100%;
      max-height: 100%;
      width: auto;
      height: auto;
      display: none;
      /* ‚úÖ hidden by default */
    }

    @media (max-width: 600px) {
      .bg { transform: scale(1.00); }
      .star {
        width: 48px;
        height: 48px;
      }
    }
  </style>
</head>

<body>
  <div class="bg" aria-hidden="true"></div>
  <div class="overlay" aria-hidden="true"></div>

  <audio id="bgm" preload="auto" src="music.mp3"></audio>

  <div class="center" id="gate">
    <div class="card">
      <h1 class="title">Buon Natale, <span id="name">Kiwi</span> üéÅ</h1>
      <p class="subtitle">Press ‚ÄúStart‚Äù and may the magic happen ‚ú®</p>
      <p>
        For my dearest Marco üéÑüéÖüèªü•Çüéäüíòüë©üèº‚Äç‚ù§Ô∏è‚Äçüíã‚Äçüë®üèª
        I wish you the happiest Christmas until now. Spend it surrounded with good food, best vibes, fun games, and most
        importantly, with people whom you love!
        When you hit start, you will see many gifts for you - every gift reveils one of our memories ‚ù§Ô∏è
        There is 46 different ones, make sure to open them all! (And turn the volume up)
        With hope and belief that this is our last Christmas apart,
        7 tons of kisses, 3 excavators of hugs, and love forever,
        Iva ‚ù§Ô∏è
      </p>
      <button class="btn" id="start">Start</button>
    </div>
  </div>

  <div class="stage" id="stage" aria-hidden="true">
    <div class="sleighWrap">
      <img src="sleigh.png" alt="Sleigh" class="sleighImg" />
      <div class="faceGlow"></div>
      <img src="face.png" alt="Face" class="face" />
    </div>
  </div>

  <div class="credit">Made with ‚ù§Ô∏è and snow.</div>

  <!-- Modal -->
  <div class="modal" id="modal" aria-hidden="true">
    <div class="modalBackdrop" id="modalBackdrop"></div>

    <div class="modalCard" role="dialog" aria-modal="true" aria-label="Gift">
      <button class="modalClose" id="modalClose">‚úï</button>

      <div class="modalBody">
        <img class="modalImg" id="modalImg" src="" alt="Gift image" />
        <video class="modalVideo" id="modalVideo" controls playsinline></video>
      </div>

      <p class="modalDesc" id="modalDesc"></p>
    </div>
  </div>

  <script>
    // -------- Personalize name: ?name=Kiwi --------
    const params = new URLSearchParams(location.search);
    const qpName = params.get('name');
    if (qpName) document.getElementById('name').textContent = qpName;

    // -------- Snow --------
    function snow(count = 90) {
      for (let i = 0; i < count; i++) {
        const s = document.createElement('div');
        s.className = 'snowflake';
        const size = Math.random() * 4 + 2;
        s.style.width = size + 'px';
        s.style.height = size + 'px';
        s.style.left = Math.random() * 100 + 'vw';
        s.style.animationDuration = 6 + Math.random() * 8 + 's';
        s.style.animationDelay = (-Math.random() * 8) + 's';
        s.style.setProperty('--drift', (Math.random() * 40 - 20) + 'vw');
        document.body.appendChild(s);
      }
    }

    // -------- Elements --------
    const startBtn = document.getElementById('start');
    const gate = document.getElementById('gate');
    const stage = document.getElementById('stage');
    const audio = document.getElementById('bgm');

    // -------- Data: photos + descriptions --------
    const TOTAL_PHOTOS = 43;
    const TOTAL_VIDEOS = 3;

    const photoDescriptions = [
      "Kiwi, devi sapere che ti amo solo per il tuo mullet",
      "Vedi?",
      "I think this trip was what really had me be sure I want you forever (and idc im abandoning my own rule of no ‚Äúforever‚Äù talk)",
      "Nessuno mi fa sorridere come il mio Kiwi",
      "Minerva came home",
      "Hey Marco, remeber when we ate chips?",
      "‚ù§Ô∏è",
      "Makica moj",
      "Guess who's hungry",
      "‚ù§Ô∏è",
      "Kiwi e Gattiva, due gattini ubriachi che non capiscono niente",
      "Mi √® piaciuto molto stare qui con te, non vedo l'ora di apprezzarlo ancora di pi√π con Francesca",
      "‚ù§Ô∏è",
      "I got eyes only for you",
      "Mr. Hawking",
      "1st date and the day we decided we're pretty damn good match",
      "Remember when we were dating for 3 days before being official",
      "Questo ragazzo mi fa venire voglia di fargli una lap dance üòÆü§≠",
      "Primo incontro con la cucina balcanica, stai per scoprire tanti nuovi sapori",
      "‚ù§Ô∏è",
      "You knew it couldn't be without this one. Love my big eyes!",
      "Simply, stay here forever ü•∫",
      "The judge and the judging committee",
      "La voglia di morderti ogni volta che ti vedo",
      "Non hai idea di quanto mi sei mancato il giorno prima di questa foto",
      "Kiwi e Gattiva gattini malvagi",
      "‚ù§Ô∏è",
      "It was real happiness i felt this day. The music, the city life üò≠ü•π‚ù§Ô∏è",
      "Woow we belong in the same color palette - we should kiss",
      "I miei begli occhi cos√¨ felici mentre cucinano",
      "Apple pie at 00:30 is one of my top activities",
      "Ti sta benissimo il mio maglione blu",
      "Omg you‚Äôre wearing my sweater - we should totally kiss",
      "There you‚Äôre kissed",
      "Even when things are going south, this is how I will hold onto you ü§ôüèº",
      "LOOK AT MY HANDSOME LITTLE KIWI",
      "Its a match. Its just a good match.",
      "Non riesco a guardarti senza sorridere da un orecchio all'altro",
      "I will say this now, and you need to remember it forever: My love for you is stronger than your love for food. Not a single challenge we come across will not scare me, and i will never choose to buy a lactose free milk (get the metaphor? ü§ì)",
      "S√¨, ti amo per il tuo  mullet, ma Marco Stathman √® sexy.",
      "Che bello il mio cannolo üòçüòçü§§",
      "The best desert I have ever had and a cake we made for Amer",
      "And with this expression, still, you my nigga",
    ];

    const videoDescriptions = [
      "XIAN OUR G!!! üêê‚ù§Ô∏è",
      "Let me bother you some more",
      "Ti amo tanto"
    ];



    if (photoDescriptions.length !== TOTAL_PHOTOS) {
      console.error(`‚ùå photoDescriptions.length=${photoDescriptions.length}, TOTAL_PHOTOS=${TOTAL_PHOTOS}`);
    }

    const giftItems = Array.from({ length: TOTAL_PHOTOS }, (_, i) => ({
      src: `memories/${i + 1}.jpg`,
      description: photoDescriptions[i] ?? `Opis za sliku ${i + 1}`
    }));

    const videoItems = Array.from({ length: TOTAL_VIDEOS }, (_, i) => ({
      src: `videos/${i + 1}.mp4`,          // npr. videos/1.mp4
      description: videoDescriptions[i] ?? `Video ${i + 1}`
    }));

    // -------- Deck shuffle (ensures every photo appears once) --------
    function shuffle(arr) {
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    let revealDeck = [];
    let revealIndex = 0;

    function resetDeck() {
      revealDeck = shuffle([...giftItems]);
      revealIndex = 0;
    }

    let videoDeck = [];
    let videoIndex = 0;

    function resetVideoDeck() {
      videoDeck = shuffle([...videoItems]);
      videoIndex = 0;
    }

    // -------- Gift skins --------
    const giftSkins = ["gift-red.png", "gift-green.png", "gift-gold.png"];
    function pickRandom(arr) { return arr[Math.floor(Math.random() * arr.length)]; }

    // -------- Modal --------
    const modal = document.getElementById("modal");
    const modalImg = document.getElementById("modalImg");
    const modalDesc = document.getElementById("modalDesc");
    const modalVideo = document.getElementById("modalVideo");

    const modalClose = document.getElementById("modalClose");
    const modalBackdrop = document.getElementById("modalBackdrop");

    function openImageModal(item) {
      // show img, hide video
      modalVideo.pause?.();
      modalVideo.removeAttribute("src");
      modalVideo.style.display = "none";

      modalImg.style.display = "block";
      modalImg.src = item.src;

      modalDesc.textContent = item.description;

      modal.classList.add("is-open");
      modal.setAttribute("aria-hidden", "false");
    }

    function openVideoModal(item) {
      // hide img, show video
      modalImg.removeAttribute("src");
      modalImg.style.display = "none";

      modalVideo.style.display = "block";
      modalVideo.src = item.src;
      modalVideo.load();

      modalDesc.textContent = item.description;

      modal.classList.add("is-open");
      modal.setAttribute("aria-hidden", "false");

      // poku≈°aj autoplay; ako browser blokira, user mo≈æe play na controls
      modalVideo.play?.().catch(() => { });
    }

    function closeModal() {
      modal.classList.remove("is-open");
      modal.setAttribute("aria-hidden", "true");

      modalImg.src = "";
      modalDesc.textContent = "";

      // stop video hard
      modalVideo.pause?.();
      modalVideo.removeAttribute("src");
      modalVideo.load();
      modalVideo.style.display = "none";

      modalImg.style.display = "block"; // default nazad
    }

    modalClose.addEventListener("click", closeModal);
    modalBackdrop.addEventListener("click", closeModal);
    window.addEventListener("keydown", (e) => {
      if (e.key === "Escape") closeModal();
    });

    // -------- Gift spawning --------
    let giftIntervalId = null;

    const STAR_IMAGE = "star.png";

    let starIntervalId = null;

    function spawnStar() {
      // infinite deck loop za videe
      if (videoIndex >= videoDeck.length) {
        resetVideoDeck();
      }

      const item = videoDeck[videoIndex];
      videoIndex++;

      const el = document.createElement("div");
      el.className = "star";

      // random pozicija + drift
      el.style.left = Math.random() * 100 + "vw";
      el.style.setProperty("--drift", (Math.random() * 26 - 13) + "vw");
      el.style.setProperty("--rot", (Math.random() * 180 - 90) + "deg");

      // sporije, ‚Äúpremium‚Äù padanje
      const dur = 9 + Math.random() * 6; // 9‚Äì15s
      el.style.animationDuration = dur + "s";

      // star image
      const img = document.createElement("img");
      img.src = STAR_IMAGE;
      img.alt = "Star";
      el.appendChild(img);

      function openFromStar(e) {
        e.preventDefault?.();
        e.stopPropagation?.();
        openVideoModal(item);
        el.remove();
      }

      // mobile-safe eventi
      el.addEventListener("pointerdown", openFromStar, { once: true });
      el.addEventListener("touchstart", openFromStar, { once: true, passive: false });
      el.addEventListener("click", openFromStar, { once: true });

      el.addEventListener("animationend", () => el.remove());

      document.body.appendChild(el);
    }

    function startStars() {
      resetVideoDeck();
      spawnStar();
      starIntervalId = setInterval(spawnStar, 1400); // gustina zvezda
    }

    function stopStars() {
      if (starIntervalId) clearInterval(starIntervalId);
      starIntervalId = null;
    }

    function spawnGift() {
      // stop if deck empty
      if (revealIndex >= revealDeck.length) {
        resetDeck();
        return;
      }

      const item = revealDeck[revealIndex];
      revealIndex++;

      const skin = pickRandom(giftSkins);

      const el = document.createElement("div");
      el.className = "gift";

      el.style.left = Math.random() * 100 + "vw";
      el.style.setProperty("--drift", (Math.random() * 30 - 15) + "vw");
      el.style.setProperty("--rot", (Math.random() * 140 - 70) + "deg");

      let dur = 6 + Math.random() * 6;
      if (skin.toLowerCase().includes("gold")) dur += 4;
      el.style.animationDuration = dur + "s";

      const img = document.createElement("img");
      img.src = skin;
      img.alt = "Gift";
      el.appendChild(img);

      el.addEventListener("click", (e) => {
        e.stopPropagation();
        openModal(item);
        el.remove();
      }, { once: true });

      el.addEventListener("animationend", () => el.remove());

      document.body.appendChild(el);
    }

    function startGifts() {
      resetDeck();
      spawnGift();
      giftIntervalId = setInterval(spawnGift, 650);
    }

    function stopGifts() {
      if (giftIntervalId) clearInterval(giftIntervalId);
      giftIntervalId = null;
    }

    // -------- Start button (ONLY ONCE) --------
    startBtn.addEventListener('click', async () => {
      try { await audio.play(); } catch (e) { }
      gate.style.display = 'none';
      stage.style.display = 'block';
      snow(95);
      startGifts();
      startStars();
    }, { once: true });
  </script>
</body>

</html>